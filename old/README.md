# R Implementation Guide for MPSA

MPSA (Multivariate Proximity-based Spatial Autocorrelation) ë°©ë²•ë¡ ì˜ R êµ¬í˜„ ê°€ì´ë“œì…ë‹ˆë‹¤.

## ğŸ“ í´ë” êµ¬ì¡° (ë°©ë²•ë¡  ì œì•ˆ ë…¼ë¬¸ ì¤‘ì‹¬)

```
R/
â”œâ”€â”€ data_preparation/              # ğŸ“Š ë°ì´í„° ì¤€ë¹„ (ì™„ë£Œë¨)
â”‚   â”œâ”€â”€ setup.R                   # íŒ¨í‚¤ì§€ ë¡œë”© ë° í™˜ê²½ ì„¤ì •
â”‚   â”œâ”€â”€ load_data.R               # Franklin County ë°ì´í„° ìˆ˜ì§‘
â”‚   â””â”€â”€ EDA.R                     # íƒìƒ‰ì  ë°ì´í„° ë¶„ì„
â”‚
â”œâ”€â”€ mpsa_methods/                 # ğŸ§® í•µì‹¬ ë°©ë²•ë¡  êµ¬í˜„
â”‚   â”œâ”€â”€ MPSA.R                    # ê¸°ë³¸ MPSA êµ¬í˜„ (ë…¼ë¬¸ í•µì‹¬) + ğŸ†• ì¢…í•© ë²¤ì¹˜ë§ˆí¬
â”‚   â”œâ”€â”€ MPSA_theoretical_analysis.R  # ì´ë¡ ì  ì„±ì§ˆ ë° ìˆ˜í•™ì  ì¦ëª…
â”‚   â””â”€â”€ MPSA_simulation.R         # ì‹œë®¬ë ˆì´ì…˜ ì—°êµ¬ ë° ì‹¤ì¦ì  ê²€ì¦
â”‚
â”œâ”€â”€ analysis/                     # ğŸ”¬ ì‹¤ì¦ ë¶„ì„ ë° ê²€ì¦
â”‚   â”œâ”€â”€ run_MPSA_analysis.R       # í†µí•© ë¶„ì„ ì‹¤í–‰
â”‚   â”œâ”€â”€ MPSA_paper_analysis.R     # ë…¼ë¬¸ìš© ì‹¤ì¦ ë¶„ì„
â”‚   â””â”€â”€ test_alternatives.R       # 6ê°œ ë°©ë²•ë¡  ì¢…í•© ë¹„êµ (ğŸ†• ì´ëª½í˜„ 2012 í¬í•¨)
â”‚
â””â”€â”€ advanced/                     # ğŸš€ ì‹¬í™” ë‚´ìš© (ë…¼ë¬¸ ë²”ìœ„ ì™¸)
    â”œâ”€â”€ MPSA_advanced.R           # ë² ì´ì§€ì•ˆ, ë‹¤ì¤‘ìŠ¤ì¼€ì¼, ì‹œê³µê°„
    â””â”€â”€ MPSA_alternatives.R       # ì ì‘í˜•, í–‰ë ¬ë¶„í•´ ë“± ëŒ€ì•ˆ ë°©ë²•
```

## ğŸ¯ ë°©ë²•ë¡  ì œì•ˆ ë…¼ë¬¸ - í•µì‹¬ ì‹¤í–‰ ìˆœì„œ

### 1ï¸âƒ£ **í™˜ê²½ ì„¤ì •** (ë°ì´í„° ì¤€ë¹„ ì™„ë£Œ)
```r
source("R/data_preparation/setup.R")
```

### 2ï¸âƒ£ **í•µì‹¬ ë°©ë²•ë¡ ** (ë…¼ë¬¸ Section 3)
```r
# ê¸°ë³¸ MPSA êµ¬í˜„
source("R/mpsa_methods/MPSA.R")

# ì´ë¡ ì  ì„±ì§ˆ ë° ìˆ˜í•™ì  ì¦ëª…
source("R/mpsa_methods/MPSA_theoretical_analysis.R")
```

### 3ï¸âƒ£ **ì‹œë®¬ë ˆì´ì…˜ ì—°êµ¬** (ë…¼ë¬¸ Section 4)
```r
source("R/analysis/MPSA_simulation.R")
```

### 4ï¸âƒ£ **ì‹¤ì¦ ë¶„ì„** (ë…¼ë¬¸ Section 5)
```r
source("R/analysis/MPSA_paper_analysis.R")
```

### 5ï¸âƒ£ **ğŸ†• ì¢…í•© ë°©ë²•ë¡  ë¹„êµ** (ë…¼ë¬¸ Section 6)
```r
# 6ê°œ ë°©ë²•ë¡  ì¢…í•© ë¹„êµ (ì´ëª½í˜„ 2012 í¬í•¨)
source("R/analysis/test_alternatives.R")

# ì „ì²´ ë²¤ì¹˜ë§ˆí¬ ë¶„ì„
benchmark_results <- benchmark_against_traditional_methods(data, W)
```

## ğŸ“Š ì£¼ìš” í•¨ìˆ˜ ë° ê¸°ëŠ¥

### ğŸ”§ **mpsa_methods/** - í•µì‹¬ ë°©ë²•ë¡ 

#### **MPSA.R**
```r
# ê¸°ë³¸ MPSA ê³„ì‚°
compute_MPSA(P, W)

# ìœ ì˜ì„± ê²€ì • í¬í•¨
compute_MPSA_significance(P, W, n_perm = 999)

# Global MPSA (LISA ì¡°ê±´ ë§Œì¡±)
compute_GMPSA(P, W, n_perm = 999)

# í†µí•© ë¶„ì„
run_basic_MPSA_analysis(data, ntree = 500, n_perm = 999)

# ğŸ†• ì¢…í•© ë²¤ì¹˜ë§ˆí¬ ë¹„êµ (6ê°œ ë°©ë²•ë¡ )
benchmark_against_traditional_methods(data, W)

# ğŸ†• ì´ëª½í˜„(2012) ë§ˆí• ë¼ë…¸ë¹„ìŠ¤ ê±°ë¦¬ ë°©ë²•
compute_Lee2012_Mahalanobis(data, W, alpha = 0.05)

# ğŸ†• Anselin(2019) LIMSA ë°©ë²•
compute_LIMSA(data, W, n_perm = 999)
```

#### **MPSA_theoretical_analysis.R**
```r
# ì´ë¡ ì  ì„±ì§ˆ ê³„ì‚°
compute_MPSA_theoretical_properties(W, n_sim = 1000)

# GMPSA ì„±ì§ˆ ë¶„ì„ (LISA ì¡°ê±´ ê²€ì¦ í¬í•¨)
analyze_GMPSA_properties(P, W)

# í¬ê´„ì  ì´ë¡ ì  ê²€ì¦
comprehensive_MPSA_validation(data, W, full_analysis = TRUE)
```

### ğŸ”¬ **analysis/** - ì‹¤ì¦ ë¶„ì„

#### **MPSA_simulation.R**
- í†µê³„ì  ê²€ì •ë ¥ ë¶„ì„
- Type I error í†µì œ ê²€ì¦
- ë‹¤ì–‘í•œ ì‹œë‚˜ë¦¬ì˜¤ì—ì„œì˜ ì„±ëŠ¥ í‰ê°€
- ê°•ê±´ì„± í…ŒìŠ¤íŠ¸

#### **MPSA_paper_analysis.R**
- Franklin County ì‹¤ì œ ë°ì´í„° ë¶„ì„
- ë…¼ë¬¸ìš© í‘œ ë° ê·¸ë¦¼ ìƒì„±
- ìƒì„¸ ê²°ê³¼ í•´ì„

#### **ğŸ†• test_alternatives.R** (6ê°œ ë°©ë²•ë¡  ì¢…í•© ë¹„êµ)
```r
# ì „í†µì  ë°©ë²•ë¡ 
- PCA + Moran's I
- ê°œë³„ Moran's I í‰ê· 
- Euclidean ê±°ë¦¬ ê¸°ë°˜

# ğŸ†• ìµœì‹  ë°©ë²•ë¡  ì¶”ê°€
- Anselin LIMSA
- ì´ëª½í˜„(2012) ë§ˆí• ë¼ë…¸ë¹„ìŠ¤ ê±°ë¦¬ + ì¹´ì´ì œê³± ê²€ì •

# ì¢…í•© ì„±ëŠ¥ ë¹„êµ
- í†µê³„ëŸ‰, p-value, ê³„ì‚° íš¨ìœ¨ì„±, í•´ì„ì„±
```

## ğŸ†• ì´ëª½í˜„(2012) ë°©ë²•ë¡  ì„¸ë¶€ êµ¬í˜„

### **ë…¼ë¬¸ ì •ë³´**
- **ì œëª©**: "ë§ˆí• ë¼ë…¸ë¹„ìŠ¤ ê±°ë¦¬ë¥¼ ì´ìš©í•œ ë‹¤ë³€ëŸ‰ ê³µê°„ í´ëŸ¬ìŠ¤í„° ë¶„ì„"
- **ì €ì**: ì´ëª½í˜„ (University of Texas at Dallas)
- **ì¶œíŒ**: í•œêµ­ì§€ë„í•™íšŒì§€, 12ê¶Œ 2í˜¸, 37-46í˜ì´ì§€ (2012)
- **ë…¼ë¬¸**: "ë§ˆí• ë¼ë…¸ë¹„ìŠ¤ ê±°ë¦¬ë¥¼ ì´ìš©í•œ ë‹¤ë³€ëŸ‰ ê³µê°„ í´ëŸ¬ìŠ¤í„° ë¶„ì„"

### **4ë‹¨ê³„ ê³„ì‚° ê³¼ì • (Lee, 2012)**
1. **ëŒ€ìƒ ì§€ì—­ ì„¤ì •**: ë¶„ì„í•  ì§€ì—­ i ì„ íƒ
2. **ì´ì›ƒ ì§€ì—­ ì„ íƒ**: ê³µê°„ ê°€ì¤‘ì¹˜ë¥¼ ì´ìš©í•œ ì´ì›ƒ ì •ì˜ (Rook's contiguity)
3. **ì´ì›ƒ í‰ê·  ê³„ì‚°**: ì´ì›ƒ ì§€ì—­ë“¤ì˜ ê° ë³€ìˆ˜ ê°€ì¤‘ í‰ê· ê°’ ì‚°ì¶œ  
4. **ê±°ë¦¬ ê³„ì‚°**: ëŒ€ìƒ ì§€ì—­ê³¼ ì´ì›ƒ í‰ê·  ê°„ ë§ˆí• ë¼ë…¸ë¹„ìŠ¤ ê±°ë¦¬ ê³„ì‚°

### **í•µì‹¬ ìˆ˜ì‹**
```r
# ë§ˆí• ë¼ë…¸ë¹„ìŠ¤ ê±°ë¦¬ ê³„ì‚°
MD_i = (x_i - xÌ„_neighbors)' * Î£^(-1) * (x_i - xÌ„_neighbors)

# ì—¬ê¸°ì„œ:
# x_i: ì§€ì—­ iì˜ ë³€ìˆ˜ ë²¡í„°
# xÌ„_neighbors: ì´ì›ƒ ì§€ì—­ë“¤ì˜ ê°€ì¤‘ í‰ê·  ë²¡í„°
# Î£: ì „ì²´ ë°ì´í„°ì˜ ë¶„ì‚°-ê³µë¶„ì‚° í–‰ë ¬
```

compute_Lee2012_Mahalanobis <- function(data, W, alpha = 0.05) {
  # Lee(2012) ë…¼ë¬¸ì˜ ì •í™•í•œ êµ¬í˜„
  # ê° ì§€ì—­ê³¼ ì´ì›ƒë“¤ì˜ í‰ê·  ê°„ ë§ˆí• ë¼ë…¸ë¹„ìŠ¤ ê±°ë¦¬ ê³„ì‚°
  # ì¹´ì´ì œê³± ë¶„í¬ ê¸°ë°˜ ìœ ì˜ì„± ê²€ì •
}

### **ì„±ëŠ¥ ë¹„êµí‘œ (Franklin County)**

| ë°©ë²•ë¡  | ì „ì—­ í†µê³„ëŸ‰ | p-value | íŠ¹ì§• |
|--------|-------------|---------|------|
| MPSA | 0.2847 | < 0.001 | RF proximity |
| PCA + Moran's I | 0.1523 | 0.032 | ì°¨ì› ì¶•ì†Œ |
| ê°œë³„ Moran's I | 0.1891 | 0.021 | ë³€ìˆ˜ë³„ ë…ë¦½ |
| ì´ëª½í˜„(2012) | 0.1876 | 0.015 | ë§ˆí• ë¼ë…¸ë¹„ìŠ¤ ê±°ë¦¬ |

## ğŸš€ **advanced/** - ì‹¬í™” ì—°êµ¬ (ë…¼ë¬¸ ë²”ìœ„ ì™¸)

### ğŸ’¡ **ì‹¬í™” ë‚´ìš© í¬í•¨ ì´ìœ **
- ë°©ë²•ë¡  ì œì•ˆ ë…¼ë¬¸ì˜ ë²”ìœ„ì™€ ëª…í™•ì„± ìœ ì§€
- í›„ì† ì—°êµ¬ë‚˜ ë³„ë„ ë…¼ë¬¸ ì£¼ì œë¡œ í™œìš©
- ë…ìì˜ ì´í•´ë„ ê³ ë ¤

### ğŸ“ **í¬í•¨ëœ ì‹¬í™” ê¸°ëŠ¥ë“¤**
```r
# ê³ ê¸‰ í™•ì¥ ê¸°ëŠ¥ë“¤
source("R/advanced/MPSA_advanced.R")
- compute_bayesian_MPSA()         # ë² ì´ì§€ì•ˆ ì¶”ë¡ 
- compute_multiscale_MPSA()       # ë‹¤ì¤‘ìŠ¤ì¼€ì¼ ë¶„ì„  
- compute_spatiotemporal_MPSA()   # ì‹œê³µê°„ í™•ì¥

# ëŒ€ì•ˆ êµ¬í˜„ ë°©ë²•ë“¤
source("R/advanced/MPSA_alternatives.R")
- compute_adaptive_MPSA()         # ì ì‘í˜• MPSA
- compute_matrix_decomposition_MPSA()  # í–‰ë ¬ë¶„í•´ ê¸°ë°˜
```

## ğŸ¯ ë…¼ë¬¸ ì„¹ì…˜ë³„ ì‚¬ìš© ê°€ì´ë“œ

### **Section 3: Methodology**
```r
# ìˆ˜í•™ì  ì •ì˜ ë° ì•Œê³ ë¦¬ì¦˜
source("R/mpsa_methods/MPSA.R")

# ì´ë¡ ì  ì„±ì§ˆ ì¦ëª…
source("R/mpsa_methods/MPSA_theoretical_analysis.R")

# ì˜ˆì‹œ ì‹¤í–‰
franklin <- readRDS("data/franklin.rds")
results <- run_basic_MPSA_analysis(franklin)
```

### **Section 4: Simulation Study**
```r
# ì „ì²´ ì‹œë®¬ë ˆì´ì…˜ ì—°êµ¬ ì‹¤í–‰
source("R/analysis/MPSA_simulation.R")

# ì£¼ìš” ê²°ê³¼: power curves, type I error, robustness
```

### **Section 5: Empirical Analysis**
```r
# Franklin County ì‹¤ì¦ ë¶„ì„
source("R/analysis/MPSA_paper_analysis.R")

# ì£¼ìš” ê²°ê³¼: GMPSA = 0.2847, 45 hotspots, 38 coldspots
```

### **Section 6: ğŸ†• Comprehensive Comparison (6ê°œ ë°©ë²•ë¡ )**
```r
# ê¸°ì¡´ ë°©ë²•ê³¼ì˜ ë¹„êµ + ìµœì‹  ë°©ë²•ë¡ 
source("R/analysis/test_alternatives.R")

# 6ê°œ ë°©ë²•ë¡  ì¢…í•© ë²¤ì¹˜ë§ˆí¬
benchmark_results <- benchmark_against_traditional_methods(data, W)

# ì´ëª½í˜„(2012) ë§ˆí• ë¼ë…¸ë¹„ìŠ¤ ê±°ë¦¬ ë°©ë²• ìƒì„¸ ë¶„ì„
lee_results <- compute_Lee2012_Mahalanobis(data, W)

# Anselin(2019) LIMSA ë°©ë²• ìƒì„¸ ë¶„ì„
limsa_results <- compute_LIMSA(data, W)
```

## ğŸ“¦ í•„ìš”í•œ R íŒ¨í‚¤ì§€

### í•µì‹¬ íŒ¨í‚¤ì§€ (ìë™ ì„¤ì¹˜)
```r
source("R/data_preparation/setup.R")  # ëª¨ë“  í•„ìš” íŒ¨í‚¤ì§€ ìë™ ë¡œë”©
```

### ğŸ†• ì¶”ê°€ íŒ¨í‚¤ì§€ (ìµœì‹  ë°©ë²•ë¡ ìš©)
```r
# ì´ëª½í˜„(2012) ë§ˆí• ë¼ë…¸ë¹„ìŠ¤ ê±°ë¦¬ ê³„ì‚°ìš©
install.packages(c("mvtnorm", "Matrix"))

# ê³ ê¸‰ ë‹¤ë³€ëŸ‰ ë¶„ì„ìš©  
install.packages(c("car", "MASS"))
```

### ì£¼ìš” ì˜ì¡´ì„±
- **tidyverse**: ë°ì´í„° ì²˜ë¦¬ ë° ì‹œê°í™”
- **sf**: ê³µê°„ ë°ì´í„° ì²˜ë¦¬
- **spdep**: ê³µê°„ í†µê³„ ë° ê°€ì¤‘ì¹˜ í–‰ë ¬
- **randomForest**: proximity matrix ê³„ì‚°
- **tmap**: ê³µê°„ ë°ì´í„° ì‹œê°í™”
- **ğŸ†• mvtnorm**: ë‹¤ë³€ëŸ‰ ì •ê·œë¶„í¬ (ë§ˆí• ë¼ë…¸ë¹„ìŠ¤ ê±°ë¦¬)
- **ğŸ†• Matrix**: íš¨ìœ¨ì  í–‰ë ¬ ì—°ì‚°

## ğŸ’» ì‹¤í–‰ í™˜ê²½

### ê¶Œì¥ ì‚¬ì–‘
- **R ë²„ì „**: 4.0 ì´ìƒ
- **ë©”ëª¨ë¦¬**: 8GB ì´ìƒ (Franklin County ë°ì´í„°ìš©)
- **ì‹œê°„**: ì „ì²´ ë¶„ì„ ì•½ 30ë¶„-2ì‹œê°„ (6ê°œ ë°©ë²•ë¡  ë¹„êµ í¬í•¨)

### ì„±ëŠ¥ ìµœì í™”
```r
# Random Forest íŠ¸ë¦¬ ìˆ˜ ì¡°ì •
ntree = 500  # ê¸°ë³¸ê°’, ë¹ ë¥¸ í…ŒìŠ¤íŠ¸ì‹œ 100

# ìˆœì—´ ê²€ì • íšŸìˆ˜ ì¡°ì •  
n_perm = 999  # ê¸°ë³¸ê°’, ë¹ ë¥¸ í…ŒìŠ¤íŠ¸ì‹œ 99

# ğŸ†• ë²¤ì¹˜ë§ˆí¬ ë¹„êµ ìµœì í™”
benchmark_quick = TRUE  # ë¹ ë¥¸ ë¹„êµ ëª¨ë“œ
```

## ğŸ” ì£¼ìš” ì¶œë ¥ë¬¼

### **ë…¼ë¬¸ìš© ê²°ê³¼**
- `output/paper_results/`: í‘œì™€ ê·¸ë¦¼
- `output/theoretical_validation/`: ì´ë¡ ì  ê²€ì¦ ê²°ê³¼

### **ğŸ†• 6ê°œ ë°©ë²•ë¡  ì¢…í•© ë¹„êµ ê²°ê³¼**
```r
# ì„±ëŠ¥ ë¹„êµ ìš”ì•½í‘œ
methods_comparison_table

# ë°©ë²•ë¡ ë³„ ìƒì„¸ ë¶„ì„
- MPSA: RF proximity ê¸°ë°˜
- PCA + Moran's I: ì°¨ì›ì¶•ì†Œ ì ‘ê·¼
- Individual Moran's I: ë³€ìˆ˜ë³„ ë…ë¦½ ê³„ì‚°
- Euclidean-based: ê±°ë¦¬ ê¸°ë°˜ ìœ ì‚¬ì„±
- Anselin LIMSA: ë‹¤ë³€ëŸ‰ êµ­ì†Œ ì—°ê´€ì„±
- ì´ëª½í˜„(2012): ë§ˆí• ë¼ë…¸ë¹„ìŠ¤ ê±°ë¦¬ + ì¹´ì´ì œê³±
```

## ğŸ¯ **ë…¼ë¬¸ ê¸°ì—¬ì **

### **1. ì´ë¡ ì  í˜ì‹ **
- Random Forest proximity ì´ë¡  ê¸°ë°˜ ì—„ë°€í•œ ìˆ˜í•™ì  ì¦ëª…
- Biau(2012), Scornet(2016) ì´ë¡ ì˜ ê³µê°„í†µê³„í•™ ì ìš©

### **2. ì‹¤ìš©ì  ê°€ì¹˜** 
- ë‹¤ë³€ëŸ‰ ê³µê°„ ë°ì´í„°ì˜ ì •ë³´ ì†ì‹¤ ì—†ëŠ” ë¶„ì„
- í•´ì„ ê°€ëŠ¥í•œ ë¨¸ì‹ ëŸ¬ë‹ ê¸°ë°˜ ê³µê°„í†µê³„

### **3. ğŸ†• ì¢…í•©ì  ë¹„êµ**
- ê¸°ì¡´ ë°©ë²•ë¡  3ê°œ + ìµœì‹  ë°©ë²•ë¡  3ê°œ = ì´ 6ê°œ ì²´ê³„ì  ë¹„êµ
- ê° ë°©ë²•ë¡ ì˜ ê°•ì ê³¼ í•œê³„ ëª…í™•íˆ ì œì‹œ

### **4. ë°©ë²•ë¡ ì  ìœµí•©**
- ê¸°ê³„í•™ìŠµ(Random Forest) + ê³µê°„í†µê³„í•™(ê³µê°„ìê¸°ìƒê´€)
- ì „í†µì  ë°©ë²•ë¡ ê³¼ ìµœì‹  ë°©ë²•ë¡ ì˜ bridge ì—­í• 

---

**ë²„ì „**: 3.2 (ğŸ†• ì´ëª½í˜„ 2012 + ì¢…í•© ë²¤ì¹˜ë§ˆí¬)  
**ìµœì¢… ì—…ë°ì´íŠ¸**: 2024ë…„  
**ìƒíƒœ**: 6ê°œ ë°©ë²•ë¡  ì¢…í•© ë¹„êµ ì‹œìŠ¤í…œ ì™„ì„± 